// Daqi table
@namespace "http://www.w3.org/2000/svg";

svg|svg { 
  forced-color-adjust: preserve-parent-color; 
}

svg|foreignObject { 
  forced-color-adjust: auto; 
}

.daqi-labels {
  display: flex;
  white-space: nowrap;
  justify-content: space-between; 
  position: relative;
  margin-top: govuk-spacing(2);
}

.daqi-bar {
  display: flex;
  height: govuk-spacing(4);
  margin-bottom: govuk-spacing(2);
  border: 1px solid transparent;
}

.daqi-bar-segment {
  width: 10%;
  height: 100%;
  margin-right: 2px;
  border-right: 1px solid transparent;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: govuk-colour("light-grey");
}

.daqi-bar-segment:last-child {
  border-right: none;
  margin-right: 0;
}

// '' DAQI numbered bar styling to match design image exactly
.daqi-numbered {
  position: relative;
  // '' Responsive width: use 590px when space allows, scale down when needed
  width: min(590px, 100%);
  max-width: 100%; // '' Prevent overflow in narrow containers
  overflow: hidden; // '' Prevent any scrolling - container must fit within bounds

  // '' Mobile: use same width approach as desktop for consistent margins
  @media (max-width: 639px) {
    width: min(590px, 100%); // '' Same as desktop - no extra padding
    max-width: 100%; // '' Same as desktop
    overflow: hidden; // '' Prevent scrolling on mobile
    
    .daqi-bar {
      width: 100%; // '' DAQI bar fills the container
    }
  }
  
  // '' Small tablet (640-768px): use same width approach as desktop
  @media (min-width: 640px) and (max-width: 767px) {
    width: min(590px, 100%); // '' Same as desktop
    max-width: 100%;
    overflow: hidden; // '' Prevent scrolling
    
    .daqi-bar {
      width: 100%;
    }
  }
  
  // '' Large tablet (768-1020px): use same width approach as desktop
  @media (min-width: 768px) and (max-width: 1019px) {
    width: min(590px, 100%); // '' Same as desktop
    max-width: 100%;
    overflow: hidden; // '' Prevent scrolling
    
    .daqi-bar {
      width: 100%;
    }
  }

  // '' Desktop: use same width approach for consistency
  @media (min-width: 1020px) {
    width: min(590px, 100%); // '' Consistent with other breakpoints
    max-width: 100%;
    overflow: hidden; // '' Prevent scrolling
  }

  .daqi-bar {
    display: grid;
    // Set to 40px for better visual balance and consistency
    height: 40px;
    margin-bottom: govuk-spacing(2);
    border: none;
    position: relative;
    // Use shared column sizing so labels and bar remain aligned
    grid-template-columns: var(--daqi-columns, repeat(9, 51px) 100px);
    gap: 3px;
    // '' separators moved to label level to avoid duplication with design
    background-image: none;
    width: 100%; // '' Ensure bar fills container
    max-width: 100%; // '' Prevent bar from exceeding container
    box-sizing: border-box; // '' Include padding/border in width calculation
    overflow: hidden; // '' Prevent bar content from causing scrolling
    
    // '' Mobile: cells scale dynamically with container while maintaining proportions
    @media (max-width: 639px) {
      display: flex !important;
      width: 100%;
      margin: 0;
      gap: 1px;
      
      .daqi-bar-segment {
        // '' Dynamic scaling maintaining desktop proportional relationships
        // '' Desktop: cells 1-9 are 51px each, cell 10 is 100px (ratio 51:100)
        &:nth-child(1),
        &:nth-child(2),
        &:nth-child(3),
        &:nth-child(4),
        &:nth-child(5),
        &:nth-child(6),
        &:nth-child(7),
        &:nth-child(8),
        &:nth-child(9) {
          flex: 51; // '' Proportional scaling based on desktop 51px
        }
        
        &:nth-child(10) {
          flex: 100; // '' Proportional scaling based on desktop 100px
        }
        
        // '' Very narrow viewports: no dividers for now
        @media (max-width: 340px) {
          // '' Will implement proper group separators
        }
      }
    }
    
    // '' Small tablet (640-768px): flexbox with proportional scaling
    @media (min-width: 640px) and (max-width: 767px) {
      display: flex !important;
      width: 100%;
      margin: 0;
      gap: 2px; // '' Smaller gap for small tablets
      
      .daqi-bar-segment {
        // '' Dynamic scaling maintaining desktop proportional relationships
        &:nth-child(1),
        &:nth-child(2),
        &:nth-child(3),
        &:nth-child(4),
        &:nth-child(5),
        &:nth-child(6),
        &:nth-child(7),
        &:nth-child(8),
        &:nth-child(9) {
          flex: 51; // '' Proportional scaling based on desktop 51px
        }
        
        &:nth-child(10) {
          flex: 100; // '' Proportional scaling based on desktop 100px
        }
      }
    }
    
    // '' Large tablet (768-1020px): flexbox with proportional scaling
    @media (min-width: 768px) and (max-width: 1019px) {
      display: flex !important;
      width: 100%;
      margin: 0;
      gap: 3px; // '' Standard gap for large tablets
      
      .daqi-bar-segment {
        // '' Dynamic scaling maintaining desktop proportional relationships
        &:nth-child(1),
        &:nth-child(2),
        &:nth-child(3),
        &:nth-child(4),
        &:nth-child(5),
        &:nth-child(6),
        &:nth-child(7),
        &:nth-child(8),
        &:nth-child(9) {
          flex: 51; // '' Proportional scaling based on desktop 51px
        }
        
        &:nth-child(10) {
          flex: 100; // '' Proportional scaling based on desktop 100px
        }
      }
    }
  }

  .daqi-bar-segment {
    height: 100%;
    border: none;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: govuk-colour("light-grey");
    box-sizing: border-box; // '' include border in width for exact alignment
    letter-spacing: 0; // '' avoid text width affecting perceived centering
  margin-right: 0; // remove generic 2px margin-right to rely solely on gap:3px
    // Let the grid column control width; keep segment content centered
    width: auto;
    
    &.daqi-1, &.daqi-2, &.daqi-3, &.daqi-4, &.daqi-5, 
    &.daqi-6, &.daqi-7, &.daqi-8, &.daqi-9, &.daqi-10 {
      // '' selected cell inner border
      box-shadow: inset 0 0 0 2px govuk-colour("black");
    }

    // '' Low-band colour override moved to top-level to avoid deep nesting
  }

  // '' Use exact design green for selected value when in Low band (1–3)
  // '' This intentionally overrides the generic $daqi-colour-* palette only for the numbered bar
  .daqi-bar-segment.daqi-1,
  .daqi-bar-segment.daqi-2,
  .daqi-bar-segment.daqi-3 {
    background-color: #31cf00; // '' slightly darker lime closer to reference image
  }

  // '' Ensure numbers remain black on bright green within numbered bar only
  .daqi-bar-segment.daqi-1 .daqi-number,
  .daqi-bar-segment.daqi-2 .daqi-number,
  .daqi-bar-segment.daqi-3 .daqi-number {
    color: govuk-colour("black");
  }

  .daqi-labels {
  display: grid;
  // Use the same columns as the bar so labels keep their alignment during resize
  grid-template-columns: var(--daqi-columns, repeat(9, 51px) 100px);
  column-gap: 3px; // '' match the bar's inter-cell gap so label centers align
    align-items: center;
    margin-top: govuk-spacing(2);
    position: relative;
    justify-items: stretch; // '' make grid items occupy full column span
    justify-content: start; // '' prevent space-between from generic .daqi-labels rule
    align-content: start;
  // padding removed to keep grid perfectly aligned with bar geometry
    width: 100%; // '' Ensure labels container fills parent
    max-width: 100%; // '' Prevent labels from exceeding container
    box-sizing: border-box; // '' Include padding/border in width calculation
    overflow: hidden; // '' Prevent label overflow from causing scrolling

    // '' Desktop default: grid-based layout
    .daqi-band {
      @include govuk-font($size: 16, $weight: regular);
      // stylelint-disable-next-line declaration-no-important
      text-align: center !important; // '' override generic .daqi-band alignment
      position: relative;
      display: block;
      justify-self: stretch;
      white-space: nowrap; // '' prevent labels from wrapping onto two lines
      // stylelint-disable-next-line declaration-no-important
      width: auto !important; // '' override generic width rules
      max-width: 100%;
      // stylelint-disable-next-line declaration-no-important
      border: 0 !important; // '' remove any generic borders
      // stylelint-disable-next-line declaration-no-important
      padding: 0 !important;
      overflow: hidden; // '' Prevent text overflow
      
      // Low - spans cells 1,2,3 (3 tracks)
      &:nth-child(1) {
        grid-column: 1 / 4;
      }
      
      // Moderate - center around cells 4-6 to give more space for the text
      &:nth-child(2) {
        grid-column: 4 / 7;
        justify-self: center;
        width: max-content;
      }
      
      // High - span cells 7–9 (center aligns to cell 8)
      &:nth-child(3) {
        grid-column: 8 / 9;
        justify-self: center;
        width: max-content;
        transform: none;
      }
      
      // Very high - center under cell 10 (100px wide track)
      &:nth-child(4) {
        grid-column: 10 / 11;
        justify-self: center;
        width: max-content;
      }
    }

    // '' Mobile: flexbox-based layout with precise GROUP center alignment
    @include govuk-media-query($until: tablet) {
      display: flex;
      width: 100%;
      margin: 5px 0 0;
      justify-content: space-around;
      position: relative;
      
      // Add responsive dividers between groups for mobile (using original working approach)
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 24px;
        background-image:
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px);
        background-position: calc(var(--daqi-divider-1, 102px) * 100% / 375px) 0, calc(var(--daqi-divider-2, 206px) * 100% / 375px) 0, calc(var(--daqi-divider-3, 309px) * 100% / 375px) 0;
        background-repeat: no-repeat;
        background-size: 3px 100%, 3px 100%, 3px 100%;
        pointer-events: none;
        z-index: 1;
      }
      
      .daqi-band {
        text-align: center;
        flex: 1;
        position: relative;
        z-index: 2;
        
        @include govuk-font($size: 14, $weight: regular);
        white-space: nowrap;
        overflow: hidden;
        
        // Reset grid positioning for mobile
        grid-column: unset;
        justify-self: unset;
        left: unset;
        transform: unset;
        width: auto;
        max-width: 100%;
      }
    }
    
    // '' Small tablet (640-768px): flexbox layout like mobile
    @media (min-width: 640px) and (max-width: 767px) {
      display: flex;
      width: 100%;
      margin: 5px 0 0;
      justify-content: space-around;
      position: relative;
      
      // Add responsive dividers between groups for small tablets
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 24px;
        background-image:
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px);
        background-position: var(--daqi-divider-1, 130px) 0, var(--daqi-divider-2, 260px) 0, var(--daqi-divider-3, 390px) 0;
        background-repeat: no-repeat;
        background-size: 3px 100%, 3px 100%, 3px 100%;
        pointer-events: none;
        z-index: 1;
      }
      
      .daqi-band {
        text-align: center;
        flex: 1;
        position: relative;
        z-index: 2;
        
        @include govuk-font($size: 14, $weight: regular); // Valid GOV.UK font size for small tablets
        white-space: nowrap;
        overflow: hidden;
        
        // Reset grid positioning
        grid-column: unset;
        justify-self: unset;
        left: unset;
        transform: unset;
        width: auto;
        max-width: 100%;
      }
    }
    
    // '' Large tablet (768-1020px): flexbox layout like mobile
    @media (min-width: 768px) and (max-width: 1019px) {
      display: flex;
      width: 100%;
      margin: 5px 0 0;
      justify-content: space-around;
      position: relative;
      
      // Add responsive dividers between groups for large tablets
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 24px;
        background-image:
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px);
        background-position: var(--daqi-divider-1, 148px) 0, var(--daqi-divider-2, 296px) 0, var(--daqi-divider-3, 444px) 0;
        background-repeat: no-repeat;
        background-size: 3px 100%, 3px 100%, 3px 100%;
        pointer-events: none;
        z-index: 1;
      }
      
      .daqi-band {
        text-align: center;
        flex: 1;
        position: relative;
        z-index: 2;
        
        @include govuk-font($size: 16, $weight: regular); // Same as desktop for large tablets
        white-space: nowrap;
        overflow: hidden;
        
        // Reset grid positioning
        grid-column: unset;
        justify-self: unset;
        left: unset;
        transform: unset;
        width: auto;
        max-width: 100%;
      }
    }
    
    // '' Extend responsive divider behavior to tablet viewports  
    // Small tablet (640-768px): show dividers with tighter positioning
    @media (min-width: 640px) and (max-width: 767px) {
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 24px;
        background-image:
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px);
        background-position: var(--daqi-divider-1, 130px) 0, var(--daqi-divider-2, 260px) 0, var(--daqi-divider-3, 390px) 0;
        background-repeat: no-repeat;
        background-size: 2px 100%, 2px 100%, 2px 100%; // Thinner lines for small tablets
        pointer-events: none;
        z-index: 1;
      }
    }
    
    // Large tablet (768-1020px): show dividers with standard positioning
    @media (min-width: 768px) and (max-width: 1019px) {
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 24px;
        background-image:
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px);
        background-position: var(--daqi-divider-1, 148px) 0, var(--daqi-divider-2, 296px) 0, var(--daqi-divider-3, 444px) 0;
        background-repeat: no-repeat;
        background-size: 3px 100%, 3px 100%, 3px 100%;
        pointer-events: none;
        z-index: 1;
      }
    }
      
    // Show dividers for desktop viewports too (JS will set proper positions)
    @media (min-width: 1020px) {
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 24px;
        background-image:
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
          linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px);
        background-position: var(--daqi-divider-1, 196px) 0, var(--daqi-divider-2, 392px) 0, var(--daqi-divider-3, 588px) 0;
        background-repeat: no-repeat;
        background-size: 3px 100%, 3px 100%, 3px 100%;
        pointer-events: none;
        z-index: 1;
      }
    }
  } // Close .daqi-labels
}

.daqi-number {
    // Use GOV.UK type-scale size to avoid build errors; keep visually tight
    @include govuk-font($size: 16, $weight: bold);
    color: govuk-colour("black");
    position: relative;
    z-index: 5;
  }

// Active/selected segment styling
.daqi-bar-segment.daqi-1,
.daqi-bar-segment.daqi-2,
.daqi-bar-segment.daqi-3 {
  background-color: $daqi-colour-1;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-bar-segment.daqi-4,
.daqi-bar-segment.daqi-5,
.daqi-bar-segment.daqi-6 {
  background-color: $daqi-colour-4;

  .daqi-number {
    color: govuk-colour("black");
  }
}

.daqi-bar-segment.daqi-7,
.daqi-bar-segment.daqi-8 {
  background-color: $daqi-colour-7;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-bar-segment.daqi-9,
.daqi-bar-segment.daqi-10 {
  background-color: $daqi-colour-9;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-band {
  // Use GOV.UK type-scale size
  @include govuk-font($size: 16, $weight: regular);
  border: 0;
  vertical-align: top;
  text-align: left;
  width: 30%;
}

.daqi-band:last-child, .daqi-band:nth-child(3) {
  width: 20%;
}

.daqi-band:last-child {
  text-align: right;
  white-space: nowrap;
}

.daqi-selected {
  font-weight: bold; 
}

@media (prefers-contrast: more) {
  .daqi-selected {
    background-color: windowText;
    color: windowText;
  }
}

@media(forced-colors: active) {
  .daqi-selected {
    // stylelint-disable-next-line declaration-no-important
      background-color: windowText !important;
      forced-color-adjust: none;
      color: govuk-colour("black");
  }
}
@media(forced-colors: active) {
  .daqi-selected,
  .aq-forecast-dd.daqi-tag--1, 
  .aq-forecast-dd.daqi-tag--2, 
  .aq-forecast-dd.daqi-tag--3, 
  .aq-forecast-dd.daqi-tag--4, 
  .aq-forecast-dd.daqi-tag--5, 
  .aq-forecast-dd.daqi-tag--6, 
  .aq-forecast-dd.daqi-tag--7, 
  .aq-forecast-dd.daqi-tag--8, 
  .aq-forecast-dd.daqi-tag--9, 
  .aq-forecast-dd.daqi-tag--10  {
    // stylelint-disable-next-line declaration-no-important
      background-color: windowText !important;
      forced-color-adjust: none;
      color: govuk-colour("black");
  }

  .aq-forecast-item {
    .aq-forecast-dd.daqi-tag--2 {
      border-right: 2px solid govuk-colour("black");  
      width: 100%;          
    } 
  }

 .aq-forecast-item:last-child { 
  .aq-forecast-dd.daqi-tag--2 {
      border-right: 1px solid windowText; 
   } 
  }
}

@media (inverted-colors: inverted) {
  .daqi-selected {
    background-color: windowText;
    color: govuk-colour("black");
  }
}

.daqi-0 {
  background-color: $daqi-colour-0;
  color: govuk-colour("black");
}

.daqi-1 {
  background-color: $daqi-colour-1;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-2 {
  background-color: $daqi-colour-2;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-3 {
  background-color: $daqi-colour-3;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-4 {
  background-color: $daqi-colour-4;
  color: govuk-colour("black");
  font-weight: bold; 
}
  
.daqi-5 {
  background-color: $daqi-colour-5;
  color: govuk-colour("black");
  font-weight: bold; 
}
  
.daqi-6 {
  background-color: $daqi-colour-6;
  color: govuk-colour("black");
  font-weight: bold; 
}
  
.daqi-7 {
  background-color: $daqi-colour-7;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-8 {
  background-color: $daqi-colour-8;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-9 {
  background-color: $daqi-colour-9;
  color: govuk-colour("white");
  font-weight: bold; 
 }
  
.daqi-10 {
  background-color: $daqi-colour-10;
  color: govuk-colour("white");
  font-weight: bold; 
}

// '' Ensure Moderate relies on grid centering exactly under cell 5 (no transform)

.govuk-details__text {
  .health-advice tr:last-child td,
  .health-advice tr:last-child th {
    border-bottom: 1px solid transparent;
  }
}

.govuk-tabs__tab {
  display: inline-block;
  max-width: 12ch;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.defra-aq-tabs__label-distance {
  padding-top: 5px;
  display: block;
  font-family: "GDS Transport", arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 400;
  font-size: 0.875rem;
  line-height: 1.1429;
  text-decoration: none;
}

@media (min-width: 40.0625em) {
  .defra-aq-tabs__label-distance {
    font-size: 1.1rem;
    line-height: 0.5;
  }
}

// '' Ensure box-sizing for consistent sizing calculations
@media (min-width: 768px) {
  .daqi-numbered {
    box-sizing: border-box;
  }
}