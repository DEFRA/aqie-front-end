// Daqi table
@namespace "http://www.w3.org/2000/svg";

svg|svg { 
  forced-color-adjust: preserve-parent-color; 
}

svg|foreignObject { 
  forced-color-adjust: auto; 
}

.daqi-labels {
  display: flex;
  white-space: nowrap;
  justify-content: space-between; 
  position: relative;
  margin-top: govuk-spacing(2);
}

.daqi-bar {
  display: flex;
  height: govuk-spacing(4);
  margin-bottom: govuk-spacing(2);
  border: 1px solid transparent;
}

.daqi-bar-segment {
  width: 10%;
  height: 100%;
  margin-right: 2px;
  border-right: 1px solid transparent;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: govuk-colour("light-grey");
}

.daqi-bar-segment:last-child {
  border-right: none;
  margin-right: 0;
}

// '' DAQI numbered bar styling with smart responsive behavior
.daqi-numbered {
  position: relative;
  
  // '' Smart responsive width strategy:
  // - Above 590px available space: maintain 590px width (parent's empty space shrinks first)
  // - Below 590px available space: shrink component to fit available space
  width: min(590px, 100%);
  max-width: 590px; // '' Never exceed design width
  min-width: 300px; // '' Minimum usable width for 10 cells
  overflow: hidden; // '' Prevent any scrolling - container must fit within bounds
  
  
  // '' The component maintains its natural width until the parent container
  // '' has been squeezed to the point where it needs to shrink the component itself

  // '' Extra small mobile optimization only
  @media (max-width: 320px) {
    min-width: 300px; // '' Ensure minimum usable width
    
    .daqi-bar {
      width: 100%; // '' DAQI bar fills the container
    }
  }

  // '' Desktop: ensure proper width for larger screens
  @media (min-width: 641px) {
    width: min(590px, 100%); // '' Consistent with smart responsive strategy
    max-width: 590px;
    overflow: hidden; // '' Prevent scrolling
  }

  .daqi-bar {
    display: grid;
    // Set to 40px for better visual balance and consistency
    height: 40px;
    margin-bottom: govuk-spacing(2);
    border: none;
    position: relative;
    // Use shared column sizing so labels and bar remain aligned
    grid-template-columns: var(--daqi-columns, repeat(9, 51px) 100px);
    gap: 3px;
    // '' separators moved to label level to avoid duplication with design
    background-image: none;
    width: 100%; // '' Ensure bar fills container
    max-width: 100%; // '' Prevent bar from exceeding container
    box-sizing: border-box; // '' Include padding/border in width calculation
    overflow: hidden; // '' Prevent bar content from causing scrolling
    
    // '' Mobile: cells scale dynamically with container while maintaining proportions
    @media (max-width: 320px) {
      // Switch to flexbox on extra small mobile for tighter control
      display: flex;
      flex-direction: row;
      margin-left: 1px; // Reduced space for borders on 320px
      margin-right: 1px; // Reduced space for borders on 320px
      gap: 1px; // Smaller gap for very small screens
    }

    @media (min-width: 321px) and (max-width: 639px) {
      display: flex;
      width: 100%;
      margin: 0;
      gap: 1px;
    }
    
    // '' Mobile and small tablet (640px and below): flexbox with proportional scaling
    @media (max-width: 640px) {
      display: flex;
      width: 100%;
      margin: 0;
      gap: 3px; // '' Standard gap for mobile
    }
  }

// '' Extra small mobile segment styling (320px and below)
@media (max-width: 320px) {
  .daqi-bar-segment {
    flex: 1; // Equal width for cells 1-9 on 320px
    border: 1px solid; // Thinner borders for space efficiency
    border-radius: 0;
    text-align: center;
    font-size: 14px; // Use standard GOV.UK font size
    min-height: 30px; // Reduced height for very small screens
    
    &:nth-child(10) {
      flex: 3; // Triple width for cell 10 to accommodate "Very high" label
    }
    
    &:not(:first-child) {
      border-left: 0;
    }
  }
}

// '' Mobile segment styling (321px-639px) - wider cell 10 for "Very high" label
@media (min-width: 321px) and (max-width: 639px) {
  .daqi-bar-segment {
    flex: 1; // Equal width for cells 1-9
    
    &:nth-child(10) {
      flex: 3; // Triple width for cell 10 to accommodate "Very high" label
    }
  }
}

// '' Mobile and tablet segment styling (640px and below) - wider cell 10 for consistent layout
@media (max-width: 640px) {
  .daqi-bar-segment {
    flex: 1; // Equal width for cells 1-9
    
    &:nth-child(10) {
      flex: 3; // Triple width for cell 10 to accommodate "Very high" label
    }
  }
}

  .daqi-bar-segment {
    height: 100%;
    border: none;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: govuk-colour("light-grey");
    box-sizing: border-box; // '' include border in width for exact alignment
    letter-spacing: 0; // '' avoid text width affecting perceived centering
  margin-right: 0; // remove generic 2px margin-right to rely solely on gap:3px
    // Let the grid column control width; keep segment content centered
    width: auto;
    
    &.daqi-1, &.daqi-2, &.daqi-3, &.daqi-4, &.daqi-5, 
    &.daqi-6, &.daqi-7, &.daqi-8, &.daqi-9, &.daqi-10 {
      // '' selected cell inner border
      box-shadow: inset 0 0 0 2px govuk-colour("black");
    }

    // '' Low-band colour override moved to top-level to avoid deep nesting
  }

  // '' Use exact design green for selected value when in Low band (1–3)
  // '' This intentionally overrides the generic $daqi-colour-* palette only for the numbered bar
  .daqi-bar-segment.daqi-1,
  .daqi-bar-segment.daqi-2,
  .daqi-bar-segment.daqi-3 {
    background-color: #31cf00; // '' slightly darker lime closer to reference image
  }

  // '' Ensure numbers remain black on bright green within numbered bar only
  .daqi-bar-segment.daqi-1 .daqi-number,
  .daqi-bar-segment.daqi-2 .daqi-number,
  .daqi-bar-segment.daqi-3 .daqi-number {
    color: govuk-colour("black");
  }

  .daqi-labels {
  display: grid;
  // Use the same columns as the bar so labels keep their alignment during resize
  grid-template-columns: var(--daqi-columns, repeat(9, 51px) 100px);
  column-gap: 3px; // '' match the bar's inter-cell gap so label centers align
    align-items: center;
    margin-top: govuk-spacing(2);
    position: relative;
    justify-items: stretch; // '' make grid items occupy full column span
    justify-content: start; // '' prevent space-between from generic .daqi-labels rule
    align-content: start;
  // padding removed to keep grid perfectly aligned with bar geometry
    width: 100%; // '' Ensure labels container fills parent
    max-width: 100%; // '' Prevent labels from exceeding container
    box-sizing: border-box; // '' Include padding/border in width calculation
    overflow: hidden; // '' Prevent label overflow from causing scrolling

    // '' Desktop default: grid-based layout
    .daqi-band {
      @include govuk-font($size: 16, $weight: regular);
      // stylelint-disable-next-line declaration-no-important
      text-align: center !important; // '' override generic .daqi-band alignment
      position: relative;
      display: block;
      justify-self: stretch;
      white-space: nowrap; // '' prevent labels from wrapping onto two lines
      // stylelint-disable-next-line declaration-no-important
      width: auto !important; // '' override generic width rules
      max-width: 100%;
      // stylelint-disable-next-line declaration-no-important
      border: 0 !important; // '' remove any generic borders
      // stylelint-disable-next-line declaration-no-important
      padding: 0 !important;
      overflow: hidden; // '' Prevent text overflow
      
      // Low - spans cells 1,2,3 (3 tracks)
      &:nth-child(1) {
        grid-column: 1 / 4;
      }
      
      // Moderate - center around cells 4-6 to give more space for the text
      &:nth-child(2) {
        grid-column: 4 / 7;
        justify-self: center;
        width: max-content;
      }
      
      // High - span cells 7–9 (center aligns to cell 8)
      &:nth-child(3) {
        grid-column: 8 / 9;
        justify-self: center;
        width: max-content;
        transform: none;
      }
      
      // Very high - center under cell 10 (100px wide track)
      &:nth-child(4) {
        grid-column: 10 / 11;
        justify-self: center;
        width: max-content;
      }
    }

    // '' Mobile: flexbox-based layout with precise GROUP center alignment
    @include govuk-media-query($until: tablet) {
      display: flex;
      width: 100%;
      margin: 5px 0 0;
      justify-content: space-around;
      position: relative;
    }

    // '' Mobile and tablet (320px-640px): position labels below specific cells
    @media (max-width: 640px) {
      display: flex;
      position: relative;
      width: 100%;
      height: 15px; // Reduced height for proper divider sizing
      margin-top: 2px; // Further reduced margin
      justify-content: flex-start; // Start from left edge

      // stylelint-disable max-nesting-depth, declaration-no-important
      .daqi-band {
        position: absolute;
        top: 0;
        text-align: center;
        white-space: nowrap; // Prevent text wrapping
        @include govuk-font($size: 14, $weight: regular); // Use valid GOV.UK font scale
        line-height: 1.0; // Very tight line height for compact display
        z-index: 10; // Ensure labels appear above other elements
      }

      // Use more specific selectors to override conflicting rules
      .daqi-band.daqi-band-low {
        left: 12.5% !important; // Center of cells 1,2,3 group (adjusted for new flex ratios)
        transform: translateX(-50%) !important; // Center the label on this position
      }

      .daqi-band.daqi-band-moderate {
        left: 38% !important; // Center of cells 4,5,6 group (fine-tuned positioning)
        transform: translateX(-50%) !important; // Center the label on this position
      }

      .daqi-band.daqi-band-high {
        left: 63.5% !important; // Center of cells 7,8,9 group (fine-tuned positioning)
        transform: translateX(-50%) !important; // Center the label on this position
      }

      .daqi-band.daqi-band-very-high {
        left: 87.5% !important; // Center of wider cell 10 (adjusted for new flex ratios)
        transform: translateX(-50%) !important; // Center the label on this position
      }
      // stylelint-enable
    }
    } // Close mobile condition
  } // Close .daqi-labels

// '' Divider pseudo-elements for mobile and tablet ranges (up to 640px)
@media (max-width: 640px) {
  .daqi-labels::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 15px; // Match container height
    background-image:
      linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
      linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
      linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px);
    background-position: var(--daqi-divider-1, 75px) 0, var(--daqi-divider-2, 150px) 0, var(--daqi-divider-3, 225px) 0;
    background-repeat: no-repeat;
    background-size: 2px 100%, 2px 100%, 2px 100%;
    pointer-events: none;
    z-index: 1;
  }
}

// '' Divider pseudo-elements for tablet/intermediate range (641px-1019px)
@media (min-width: 641px) and (max-width: 1019px) {
  .daqi-labels::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 20px; // Intermediate height between mobile (15px) and desktop (24px)
    background-image:
      linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
      linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
      linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px);
    background-position: var(--daqi-divider-1, 130px) 0, var(--daqi-divider-2, 260px) 0, var(--daqi-divider-3, 390px) 0;
    background-repeat: no-repeat;
    background-size: 2px 100%, 2px 100%, 2px 100%; // Same as mobile size
    pointer-events: none;
    z-index: 1;
  }
}


@media (min-width: 1020px) {
  .daqi-labels::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 24px;
    background-image:
      linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
      linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px),
      linear-gradient(90deg, transparent 1px, $govuk-border-colour 1px 2px, transparent 2px);
    background-position: var(--daqi-divider-1, 196px) 0, var(--daqi-divider-2, 392px) 0, var(--daqi-divider-3, 588px) 0;
    background-repeat: no-repeat;
    background-size: 3px 100%, 3px 100%, 3px 100%;
    pointer-events: none;
    z-index: 1;
  }
}

// '' Extra small mobile label styling (320px and below)
@media (max-width: 320px) {
  .daqi-labels .daqi-band {
    // Position is set in parent container - remove conflicting properties
    // stylelint-disable declaration-no-important
    position: absolute !important; // Override any flex positioning
    // stylelint-enable
    flex: none; // Remove flex sizing
    width: auto; // Let content determine width
    text-align: center;
    z-index: 2;
    
    // Use smaller font size for 320px to fit better
    @include govuk-font($size: 14, $weight: regular);
    white-space: nowrap;
    overflow: visible; // Allow text to show fully
    
    // Reset grid and flex positioning
    grid-column: unset;
    justify-self: unset;
    // stylelint-disable declaration-no-important
    left: unset !important; // Will be overridden by parent positioning
    transform: unset !important; // Will be overridden by parent positioning
    // stylelint-enable
    max-width: none; // Allow labels to size naturally
    
    // Minimal padding for 320px
    padding: 0;
    margin: 0;
    line-height: 1.1;
  }
}

// '' Mobile label styling (321px-639px)
@media (min-width: 321px) and (max-width: 639px) {
  .daqi-labels .daqi-band {
    text-align: center;
    flex: 1;
    position: relative;
    z-index: 2;
    
    @include govuk-font($size: 14, $weight: regular);
    white-space: nowrap;
    overflow: hidden;
    
    // Reset grid positioning for mobile
    grid-column: unset;
    justify-self: unset;
    left: unset;
    transform: unset;
    width: auto;
    max-width: 100%;
  }
}

.daqi-number {
    // Use GOV.UK type-scale size to avoid build errors; keep visually tight
    @include govuk-font($size: 16, $weight: bold);
    color: govuk-colour("black");
    position: relative;
    z-index: 5;
  }

// Active/selected segment styling
.daqi-bar-segment.daqi-1,
.daqi-bar-segment.daqi-2,
.daqi-bar-segment.daqi-3 {
  background-color: $daqi-colour-1;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-bar-segment.daqi-4,
.daqi-bar-segment.daqi-5,
.daqi-bar-segment.daqi-6 {
  background-color: $daqi-colour-4;

  .daqi-number {
    color: govuk-colour("black");
  }
}

.daqi-bar-segment.daqi-7,
.daqi-bar-segment.daqi-8 {
  background-color: $daqi-colour-7;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-bar-segment.daqi-9,
.daqi-bar-segment.daqi-10 {
  background-color: $daqi-colour-9;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-band {
  // Use GOV.UK type-scale size
  @include govuk-font($size: 16, $weight: regular);
  border: 0;
  vertical-align: top;
  text-align: left;
  width: 30%;
}

.daqi-band:last-child, .daqi-band:nth-child(3) {
  width: 20%;
}

.daqi-band:last-child {
  text-align: right;
  white-space: nowrap;
}

.daqi-selected {
  font-weight: bold; 
}

@media (prefers-contrast: more) {
  .daqi-selected {
    background-color: windowText;
    color: windowText;
  }
}

@media(forced-colors: active) {
  .daqi-selected {
    // stylelint-disable-next-line declaration-no-important
      background-color: windowText !important;
      forced-color-adjust: none;
      color: govuk-colour("black");
  }
}
@media(forced-colors: active) {
  .daqi-selected,
  .aq-forecast-dd.daqi-tag--1, 
  .aq-forecast-dd.daqi-tag--2, 
  .aq-forecast-dd.daqi-tag--3, 
  .aq-forecast-dd.daqi-tag--4, 
  .aq-forecast-dd.daqi-tag--5, 
  .aq-forecast-dd.daqi-tag--6, 
  .aq-forecast-dd.daqi-tag--7, 
  .aq-forecast-dd.daqi-tag--8, 
  .aq-forecast-dd.daqi-tag--9, 
  .aq-forecast-dd.daqi-tag--10  {
    // stylelint-disable-next-line declaration-no-important
      background-color: windowText !important;
      forced-color-adjust: none;
      color: govuk-colour("black");
  }

  .aq-forecast-item {
    .aq-forecast-dd.daqi-tag--2 {
      border-right: 2px solid govuk-colour("black");  
      width: 100%;          
    } 
  }

 .aq-forecast-item:last-child { 
  .aq-forecast-dd.daqi-tag--2 {
      border-right: 1px solid windowText; 
   } 
  }
}

@media (inverted-colors: inverted) {
  .daqi-selected {
    background-color: windowText;
    color: govuk-colour("black");
  }
}

.daqi-0 {
  background-color: $daqi-colour-0;
  color: govuk-colour("black");
}

.daqi-1 {
  background-color: $daqi-colour-1;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-2 {
  background-color: $daqi-colour-2;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-3 {
  background-color: $daqi-colour-3;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-4 {
  background-color: $daqi-colour-4;
  color: govuk-colour("black");
  font-weight: bold; 
}
  
.daqi-5 {
  background-color: $daqi-colour-5;
  color: govuk-colour("black");
  font-weight: bold; 
}
  
.daqi-6 {
  background-color: $daqi-colour-6;
  color: govuk-colour("black");
  font-weight: bold; 
}
  
.daqi-7 {
  background-color: $daqi-colour-7;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-8 {
  background-color: $daqi-colour-8;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-9 {
  background-color: $daqi-colour-9;
  color: govuk-colour("white");
  font-weight: bold; 
 }
  
.daqi-10 {
  background-color: $daqi-colour-10;
  color: govuk-colour("white");
  font-weight: bold; 
}

// '' Ensure Moderate relies on grid centering exactly under cell 5 (no transform)

.govuk-details__text {
  .health-advice tr:last-child td,
  .health-advice tr:last-child th {
    border-bottom: 1px solid transparent;
  }
}

.govuk-tabs__tab {
  display: inline-block;
  max-width: 12ch;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.defra-aq-tabs__label-distance {
  padding-top: 5px;
  display: block;
  font-family: "GDS Transport", arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 400;
  font-size: 0.875rem;
  line-height: 1.1429;
  text-decoration: none;
}

@media (min-width: 40.0625em) {
  .defra-aq-tabs__label-distance {
    font-size: 1.1rem;
    line-height: 0.5;
  }
}

// '' Ensure box-sizing for consistent sizing calculations
@media (min-width: 768px) {
  .daqi-numbered {
    box-sizing: border-box;
  }
}