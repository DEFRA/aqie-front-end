// Daqi table
@namespace "http://www.w3.org/2000/svg";

svg|svg { 
  forced-color-adjust: preserve-parent-color; 
}

svg|foreignObject { 
  forced-color-adjust: auto; 
}

.daqi-labels {
  display: flex;
  white-space: nowrap;
  justify-content: space-between; 
}

.daqi-bar {
  display: flex;
  height: govuk-spacing(4);
  margin-bottom: govuk-spacing(2);
  border: 1px solid transparent;
}

.daqi-bar-segment {
  width: 10%;
  height: 100%;
  margin-right: 2px;
  border-right: 1px solid transparent;
}

.daqi-bar-segment:last-child {
  border-right: none;
  margin-right: 0;
}

// '' DAQI numbered bar styling with smart responsive behavior
.daqi-numbered {
  position: relative;
  
  // '' Smart responsive width strategy:
  // - Above 590px available space: maintain 590px width (parent's empty space shrinks first)
  // - Below 590px available space: shrink component to fit available space
  width: min(590px, 100%);
  max-width: 590px; // '' Never exceed design width
  min-width: 280px; // '' Reduced minimum width to prevent bleeding on small viewports
  overflow: hidden; // '' Prevent any scrolling - container must fit within bounds
  
  
  // '' The component maintains its natural width until the parent container
  // '' has been squeezed to the point where it needs to shrink the component itself

  // '' Extra small mobile optimization for very narrow viewports
  @media (max-width: 360px) {
    min-width: 280px; // '' Reduced minimum to fit in narrow viewports
    width: 100%; // '' Fill available space completely
    
    .daqi-bar {
      width: 100%; // '' DAQI bar fills the container
      min-width: 0; // '' Allow shrinking below default minimums
    }
  }

  // '' Responsive margin strategy to match container structure
  // '' Mobile (640px and below): no margins since container has no left margin
  @media (max-width: 640px) {
    max-width: calc(100vw - 16px); // '' Prevent horizontal overflow with minimal margins
    margin-right: 0; // '' No right margin since container has no left margin
    
    .daqi-bar {
      max-width: 100%; // '' Ensure bar doesn't exceed container
    }
  }

  // '' Tablet and larger mobile (641px to 1019px): balance the 15px left margin from main container
  @media (min-width: 641px) and (max-width: 1019px) {
    max-width: calc(100vw - 32px); // '' Prevent horizontal overflow with 16px margins
    margin-right: 15px; // '' Add 15px right margin to balance the 15px left margin from main container
    
    .daqi-bar {
      max-width: 100%; // '' Ensure bar doesn't exceed container
    }
  }

  // '' Desktop: ensure proper width for larger screens
  @media (min-width: 641px) {
    width: min(590px, 100%); // '' Consistent with smart responsive strategy
    max-width: 590px;
    overflow: hidden; // '' Prevent scrolling
  }

  .daqi-bar {
    display: flex; // '' Use flexbox for truly responsive layout
    // Set to 40px for better visual balance and consistency
    height: 40px;
    margin-bottom: govuk-spacing(2);
    border: none;
    position: relative;
    // '' Use flexible sizing that responds to container width automatically
    width: 100%; // '' Always fill parent container
    max-width: 100%; // '' Never exceed container
    box-sizing: border-box; // '' Include padding/border in width calculation
    overflow: hidden; // '' Prevent content from causing scrolling
    gap: 3px; // '' Standard gap between cells
    
    // '' Responsive gap based on container width
    @media (max-width: 360px) {
      gap: 1px; // '' Smaller gap for very narrow containers
    }
    
    @media (min-width: 361px) and (max-width: 430px) {
      gap: 2px; // '' Medium gap for narrow containers
    }
    
    // '' Remove all JavaScript-dependent grid styling
    // '' Let flexbox handle responsive sizing automatically
  }

// '' Unified responsive segment styling using flexbox with EXACT original proportions
.daqi-bar-segment {
  // '' Preserve exact original grid proportions: 51px for segments 1-9, 100px for segment 10
  flex: 51; // '' Default: 51 flex units for segments 1-9 (matches original 51px)
  height: 100%;
  border: none;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: govuk-colour("light-grey");
  box-sizing: border-box;
  letter-spacing: 0;
  margin-right: 0;
  width: auto;
  min-width: 0; // '' Allow shrinking below content width
  overflow: hidden; // '' Prevent content overflow
  font-size: 14px; // '' Responsive font size
  text-align: center;
  
  // '' Special sizing for segment 10 ("Very high") - exact original proportion
  &:nth-child(10) {
    flex: 100; // '' 100 flex units to match original 100px width
    font-weight: bold; // '' Emphasize the highest level
  }
  
  // '' Keep same flex ratios across all screen sizes to maintain mobile label alignment
  @media (max-width: 360px) {
    font-size: 12px; // '' Smaller font for very narrow containers
    padding: 1px; // '' Minimal padding
    // '' Keep same flex ratios - don't change proportions
  }
  
  @media (min-width: 361px) and (max-width: 500px) {
    font-size: 13px; // '' Medium font for narrow containers
    // '' Keep same flex ratios - don't change proportions
  }
  
  @media (min-width: 501px) {
    font-size: 14px; // '' Standard font for wider containers
    // '' Keep same flex ratios - don't change proportions
  }
}
    
    &.daqi-1, &.daqi-2, &.daqi-3, &.daqi-4, &.daqi-5, 
    &.daqi-6, &.daqi-7, &.daqi-8, &.daqi-9, &.daqi-10 {
      // '' selected cell inner border
      box-shadow: inset 0 0 0 2px govuk-colour("black");
    }

    // '' Low-band colour override moved to top-level to avoid deep nesting
  }

  // '' Use exact design green for selected value when in Low band (1–3)
  // '' Removed duplicate daqi-1,2,3 selectors - consolidated with unified active segment styling below

// '' UNIFIED ROBUST FLEXBOX LABELS AND DIVIDERS - consistent across ALL viewports
// '' SOLUTION: Both labels and dividers now use flexbox-based positioning for perfect alignment
// '' - Labels use flex ratios that match the DAQI bar segments exactly
// '' - Dividers use CSS calc() with percentages derived from same flex ratios
// '' - No JavaScript delays or CSS custom properties needed for dividers
// '' - Both update immediately when browser window is resized, eliminating lag
.daqi-labels {
  display: flex; // '' Always use flexbox for consistent alignment with bar
  position: relative;
  margin-top: govuk-spacing(2);
  white-space: nowrap;
  width: 100%;
  height: auto;
  // '' Use the EXACT same flex ratios as the DAQI bar for perfect alignment
  gap: 3px; // '' Match the bar's gap exactly
  
  .daqi-band {
    font-weight: 500;
    box-sizing: border-box;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    @include govuk-font($size: 14, $weight: regular);
    line-height: 1.0;
    
    // '' Each label area matches its corresponding segment group's total flex ratio
    // '' "Low" spans segments 1-3 (each segment = flex: 51)
    &.daqi-band-low {
      flex: 153; // '' 3 segments × 51 flex each = 153 total
      order: 1;
    }
    
    // '' "Moderate" spans segments 4-6 (each segment = flex: 51)
    &.daqi-band-moderate {
      flex: 153; // '' 3 segments × 51 flex each = 153 total
      order: 2;
    }
    
    // '' "High" spans segments 7-9 (each segment = flex: 51)
    &.daqi-band-high {
      flex: 153; // '' 3 segments × 51 flex each = 153 total
      order: 3;
    }
    
    // '' "Very high" matches segment 10 exactly
    &.daqi-band-very-high {
      flex: 100; // '' Exactly matches segment 10's flex ratio
      order: 4;
    }
  }

  // '' Responsive adjustments that maintain alignment with bar
  @media (max-width: 360px) {
    gap: 1px; // '' Match bar's responsive gap exactly
  }
  
  @media (min-width: 361px) and (max-width: 430px) {
    gap: 2px; // '' Match bar's responsive gap exactly
  }
}

// '' Responsive font sizing for labels
@media (max-width: 430px) {
  .daqi-labels .daqi-band {
    @include govuk-font($size: 14, $weight: regular); // '' Use valid GOV.UK font size
    
    // '' Keep proportions regardless of gap size
    &.daqi-band-low,
    &.daqi-band-moderate,
    &.daqi-band-high {
      flex: 153;
    }
  }
}

@media (min-width: 431px) {
  .daqi-labels .daqi-band {
    @include govuk-font($size: 14, $weight: regular);
  }
}

// '' Flexbox-based dividers for mobile and tablet ranges (up to 640px) - no JavaScript needed
@media (max-width: 640px) {
  .daqi-labels {
    // Use flexbox-positioned dividers instead of CSS custom properties
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 15px; // Match container height
      pointer-events: none;
      z-index: 1;
      
      // Ensure crispy, pixel-perfect rendering
      image-rendering: crisp-edges;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: pixelated;
      backface-visibility: hidden;
      transform: translateZ(0); // Force hardware acceleration
      
      // Create flexbox-aligned dividers using exact flex ratios
      // Total flex: Low(153) + Moderate(153) + High(153) + VeryHigh(100) = 559
      // Crispy 1px dividers moved 2px left for perfect alignment
      background: 
        // Divider after "Low" - 153/559 = 27.37% (moved 2px left)
        linear-gradient(90deg, transparent calc(27.37% - 0.5px), $govuk-border-colour calc(27.37% - 0.5px) calc(27.37% + 0.5px), transparent calc(27.37% + 0.5px)),
        // Divider after "Moderate" - (153+153)/559 = 54.74% (moved 3px left)
        linear-gradient(90deg, transparent calc(54.74% + 0px), $govuk-border-colour calc(54.74% + 0px) calc(54.74% + 1px), transparent calc(54.74% + 1px)),
        // Divider after "High" - (153+153+153)/559 = 82.11% (moved 3px left)
        linear-gradient(90deg, transparent calc(82.11% + 1.5px), $govuk-border-colour calc(82.11% + 1.5px) calc(82.11% + 2.5px), transparent calc(82.11% + 2.5px));
    }
  }
}

// '' Flexbox-based dividers for tablet/intermediate range (641px-1019px) - no JavaScript needed
@media (min-width: 641px) and (max-width: 1019px) {
  .daqi-labels {
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 20px; // Intermediate height between mobile (15px) and desktop (24px)
      pointer-events: none;
      z-index: 1;
      
      // Ensure crispy, pixel-perfect rendering
      image-rendering: crisp-edges;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: pixelated;
      backface-visibility: hidden;
      transform: translateZ(0); // Force hardware acceleration
      
      // Create flexbox-aligned dividers using exact flex ratios
      // Total flex: Low(153) + Moderate(153) + High(153) + VeryHigh(100) = 559
      // Crispy 1px dividers moved 2px left for perfect alignment
      background: 
        // Divider after "Low" - 153/559 = 27.37% (moved 2px left)
        linear-gradient(90deg, transparent calc(27.37% + 0px), $govuk-border-colour calc(27.37% + 0px) calc(27.37% + 1px), transparent calc(27.37% + 1px)),
        // Divider after "Moderate" - (153+153)/559 = 54.74% (moved 3px left)
        linear-gradient(90deg, transparent calc(54.74% + 1px), $govuk-border-colour calc(54.74% + 1px) calc(54.74% + 2px), transparent calc(54.74% + 2px)),
        // Divider after "High" - (153+153+153)/559 = 82.11% (moved 3px left)
        linear-gradient(90deg, transparent calc(82.11% + 3px), $govuk-border-colour calc(82.11% + 3px) calc(82.11% + 4px), transparent calc(82.11% + 4px));
    }
  }
}


// '' Flexbox-based dividers for desktop range (1020px+) - no JavaScript needed
@media (min-width: 1020px) {
  .daqi-labels {
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 24px;
      pointer-events: none;
      z-index: 1;
      
      // Ensure crispy, pixel-perfect rendering
      image-rendering: crisp-edges;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: pixelated;
      backface-visibility: hidden;
      transform: translateZ(0); // Force hardware acceleration
      
      // Create flexbox-aligned dividers using exact flex ratios
      // Total flex: Low(153) + Moderate(153) + High(153) + VeryHigh(100) = 559
      // Crispy 1px dividers moved 2px left for perfect alignment
      background: 
        // Divider after "Low" - 153/559 = 27.37% (moved 2px left)
        linear-gradient(90deg, transparent calc(27.37% + 0.5px), $govuk-border-colour calc(27.37% + 0.5px) calc(27.37% + 1.5px), transparent calc(27.37% + 1.5px)),
        // Divider after "Moderate" - (153+153)/559 = 54.74% (moved 3px left)
        linear-gradient(90deg, transparent calc(54.74% + 2px), $govuk-border-colour calc(54.74% + 2px) calc(54.74% + 3px), transparent calc(54.74% + 3px)),
        // Divider after "High" - (153+153+153)/559 = 82.11% (moved 3px left)
        linear-gradient(90deg, transparent calc(82.11% + 4.5px), $govuk-border-colour calc(82.11% + 4.5px) calc(82.11% + 5.5px), transparent calc(82.11% + 5.5px));
    }
  }
}

// '' Extra small mobile label styling (320px and below)
@media (max-width: 320px) {
  .daqi-labels .daqi-band {
    // Position is set in parent container - remove conflicting properties
    // stylelint-disable declaration-no-important
    position: absolute !important; // Override any flex positioning
    // stylelint-enable
    flex: none; // Remove flex sizing
    width: auto; // Let content determine width
    text-align: center;
    z-index: 2;
    
    // Use smaller font size for 320px to fit better
    @include govuk-font($size: 14, $weight: regular);
    white-space: nowrap;
    overflow: visible; // Allow text to show fully
    
    // Reset grid and flex positioning
    grid-column: unset;
    justify-self: unset;
    // stylelint-disable declaration-no-important
    left: unset !important; // Will be overridden by parent positioning
    transform: unset !important; // Will be overridden by parent positioning
    // stylelint-enable
    max-width: none; // Allow labels to size naturally
    
    // Minimal padding for 320px
    padding: 0;
    margin: 0;
    line-height: 1.1;
  }
}

// '' Mobile label styling (321px-639px)
@media (min-width: 321px) and (max-width: 639px) {
  .daqi-labels .daqi-band {
    text-align: center;
    flex: 1;
    position: relative;
    z-index: 2;
    
    @include govuk-font($size: 14, $weight: regular);
    white-space: nowrap;
    overflow: hidden;
    
    // Reset grid positioning for mobile
    grid-column: unset;
    justify-self: unset;
    left: unset;
    transform: unset;
    width: auto;
    max-width: 100%;
  }
}

.daqi-number {
    // Use GOV.UK type-scale size to avoid build errors; keep visually tight
    @include govuk-font($size: 16, $weight: bold);
    color: govuk-colour("black");
    position: relative;
    z-index: 5;
  }

// Active/selected segment styling - each level gets its unique color
.daqi-bar-segment.daqi-1 {
  background-color: $daqi-colour-1;

  .daqi-number {
    color: govuk-colour("black");
  }
}

.daqi-bar-segment.daqi-2 {
  background-color: $daqi-colour-2;

  .daqi-number {
    color: govuk-colour("black");
  }
}

.daqi-bar-segment.daqi-3 {
  background-color: $daqi-colour-3;

  .daqi-number {
    color: govuk-colour("black");
  }
}

.daqi-bar-segment.daqi-4 {
  background-color: $daqi-colour-4;

  .daqi-number {
    color: govuk-colour("black");
  }
}

.daqi-bar-segment.daqi-5 {
  background-color: $daqi-colour-5;

  .daqi-number {
    color: govuk-colour("black");
  }
}

.daqi-bar-segment.daqi-6 {
  background-color: $daqi-colour-6;

  .daqi-number {
    color: govuk-colour("black");
  }
}

.daqi-bar-segment.daqi-7 {
  background-color: $daqi-colour-7;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-bar-segment.daqi-8 {
  background-color: $daqi-colour-8;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-bar-segment.daqi-9 {
  background-color: $daqi-colour-9;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-bar-segment.daqi-10 {
  background-color: $daqi-colour-10;

  .daqi-number {
    color: govuk-colour("white");
  }
}

.daqi-band {
  @include govuk-font($size: 16, $weight: regular);
  border: 0;
  vertical-align: top;
  text-align: left;
  width: 30%;
}

.daqi-band:last-child, .daqi-band:nth-child(3) {
  width: 20%;
}

.daqi-band:last-child {
  text-align: right;
  white-space: nowrap;
}

.daqi-selected {
  font-weight: bold; 
}

@media (prefers-contrast: more) {
  .daqi-selected {
    background-color: windowText;
    color: windowText;
  }
}

@media(forced-colors: active) {
  .daqi-selected {
    // stylelint-disable-next-line declaration-no-important
      background-color: windowText !important;
      forced-color-adjust: none;
      color: govuk-colour("black");
  }
}
@media(forced-colors: active) {
  .daqi-selected,
  .aq-forecast-dd.daqi-tag--1, 
  .aq-forecast-dd.daqi-tag--2, 
  .aq-forecast-dd.daqi-tag--3, 
  .aq-forecast-dd.daqi-tag--4, 
  .aq-forecast-dd.daqi-tag--5, 
  .aq-forecast-dd.daqi-tag--6, 
  .aq-forecast-dd.daqi-tag--7, 
  .aq-forecast-dd.daqi-tag--8, 
  .aq-forecast-dd.daqi-tag--9, 
  .aq-forecast-dd.daqi-tag--10  {
    // stylelint-disable-next-line declaration-no-important
      background-color: windowText !important;
      forced-color-adjust: none;
      color: Window;
  }

  .aq-forecast-item {
    .aq-forecast-dd.daqi-tag--1, 
    .aq-forecast-dd.daqi-tag--2, 
    .aq-forecast-dd.daqi-tag--3, 
    .aq-forecast-dd.daqi-tag--4, 
    .aq-forecast-dd.daqi-tag--5, 
    .aq-forecast-dd.daqi-tag--6, 
    .aq-forecast-dd.daqi-tag--7, 
    .aq-forecast-dd.daqi-tag--8, 
    .aq-forecast-dd.daqi-tag--9, 
    .aq-forecast-dd.daqi-tag--10 {
      border-right: 2px solid Window;  
      width: 100%;          
    } 
  }

 .aq-forecast-item:last-child { 
  .aq-forecast-dd.daqi-tag--1, 
  .aq-forecast-dd.daqi-tag--2, 
  .aq-forecast-dd.daqi-tag--3, 
  .aq-forecast-dd.daqi-tag--4, 
  .aq-forecast-dd.daqi-tag--5, 
  .aq-forecast-dd.daqi-tag--6, 
  .aq-forecast-dd.daqi-tag--7, 
  .aq-forecast-dd.daqi-tag--8, 
  .aq-forecast-dd.daqi-tag--9, 
  .aq-forecast-dd.daqi-tag--10  {
      border-right: 1px solid windowText; 
   } 
  }
}

@media (inverted-colors: inverted) {
  .daqi-selected {
    background-color: windowText;
    color: govuk-colour("black");
  }
}

.daqi-0 {
  background-color: $daqi-colour-0;
  color: govuk-colour("black");
}

.daqi-1 {
  background-color: $daqi-colour-1;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-2 {
  background-color: $daqi-colour-2;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-3 {
  background-color: $daqi-colour-3;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-4 {
  background-color: $daqi-colour-4;
  color: govuk-colour("black");
  font-weight: bold; 
}
  
.daqi-5 {
  background-color: $daqi-colour-5;
  color: govuk-colour("black");
  font-weight: bold; 
}
  
.daqi-6 {
  background-color: $daqi-colour-6;
  color: govuk-colour("black");
  font-weight: bold; 
}
  
.daqi-7 {
  background-color: $daqi-colour-7;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-8 {
  background-color: $daqi-colour-8;
  color: govuk-colour("white");
  font-weight: bold; 
}
  
.daqi-9 {
  background-color: $daqi-colour-9;
  color: govuk-colour("white");
  font-weight: bold; 
 }
  
.daqi-10 {
  background-color: $daqi-colour-10;
  color: govuk-colour("white");
  font-weight: bold; 
}

.govuk-details__text {
  .health-advice tr:last-child td, .health-advice tr:last-child th {
    border-bottom: 1px solid transparent;
  }
}

.govuk-tabs__tab {
  display: inline-block;
  max-width: 12ch;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.defra-aq-tabs__label-distance {
  padding-top: 5px;
  display: block;
  font-family: "GDS Transport", arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 400;
  font-size: 0.875rem;
  line-height: 1.1429;
  text-decoration: none;
}

@media (min-width: 40.0625em) {
  .defra-aq-tabs__label-distance {
    font-size: 1.1rem;
    line-height: 0.5;
  }
}